function work_add_images(o,e){var t=0,e=$("#work-images-container"),i="";for(void 0==o.length&&(o=[o]),t=0;t<o.length;t++)i='<span data-id="'+o[t].id+'" style="background-image: url('+o[t].thumbnail+');"><a href="#"><span class="fa fa-times"></span></a></span>',i+='<input type="hidden" name="images[]" id="image-'+o[t].id+'" value="'+o[t].url+"|"+o[t].title+'">',e.append(i)}!function(o){var e,t;this.WorksForm=function(){this.identifier="Professional Works Project Form",t=this},WorksForm.prototype.init=function(){o("#work-schedule").datetimepicker({format:"Y-m-d H:i"}),o("#work-status").change(function(){switch(o("#work-status").val()){case"draft":o("#work-submit-forms").html(workLang.savedraft);break;case"public":o("#work-submit-forms").html(workLang.savepublish);break;case"private":o("#work-submit-forms").html(workLang.saveprivate);break;case"scheduled":o("#work-submit-forms").html(workLang.saveschedule)}return"private"==o(this).val()?(o("#visibility-groups").slideDown(250),void o("#visibility-schedule").slideUp(250)):"scheduled"==o(this).val()?(o("#visibility-groups").slideUp(250),void o("#visibility-schedule").slideDown(250,function(){})):(o("#visibility-groups").slideUp(250),void o("#visibility-schedule").slideUp(250))}),o("body").on("click","#work-images-container > span > a",function(){var e=o(this).parent().data("id");return o("#image-"+e).remove(),o(this).parent().fadeOut(250,function(){o(this).remove()}),!1}),o("a#add-field-name").click(function(){"Add New"==o(this).text()?(o("#dmeta-sel").hide(),o("#dmeta").show(),o(this).text("Cancel")):(o("#dmeta-sel").show(),o("#dmeta").hide(),o(this).text("Add New"))}),o("#add-field").click(function(){if(""!=o("#dvalue").val()){o("#dmeta-sel").is(":visible")?name=o("#dmeta-sel").val():o("#dmeta-sel").length>0?(name=o("#dmeta").val(),o("#dmeta-sel").show(),o("#dmeta").hide(),o("#dmeta").val(""),o(this).text("Add New")):(name=o("#dmeta").val(),o("#dmeta").val(""),o(this).text("Add New"));var e='<div class="row"><div class="col-sm-4"><div class="form-group"><input type="text" class="form-control" name="meta_name[]" value="'+name+'" /><br><button type="button" class="btn btn-warning btn-sm delete-meta">Delete</button></div></div>';e+='<div class="col-sm-8"><div class="form-group"><textarea class="form-control" name="meta_value[]">'+o("#dvalue").val()+"</textarea></div></div></div>",o("#dvalue").val(""),o("#existing-meta > .row:first-child").after(e)}}),o("#existing-meta").on("click",".delete-meta",function(){o(this).parent().parent().parent().remove()}),o("#add-meta-button").click(function(){return o(this).html()==workLang.addnew?(o("#dmeta-sel").hide(),o("#dmeta").show(),o(this).html(workLang.cancel)):(o("#dmeta-sel").show(),o("#dmeta").hide(),o(this).html(workLang.addnew)),!1}),o("#work-submit-forms").click(function(){var i='<div id="work-blocker"></div><div id="work-blocker-info"><span>'+workLang.check+'</span><button type="button" class="btn btn-info">'+workLang.cancel+"</button>";i+='<button class="btn btn-danger">'+workLang.ok+"</button></div>",o("body").append(i),o("#work-blocker").fadeIn("fast",function(){o("#work-blocker-info").fadeIn("fast"),t.verifyFields()}),o("#work-blocker-info button").click(function(){o("#work-blocker-info").fadeOut("fast",function(){o("#work-blocker").fadeOut("fast",function(){o("#work-blocker-info").remove(),o("#work-blocker").remove(),o(e).focus()})})})}),o("#project-videos input[data-id='video-url']").on("input change",function(){t.showVideoControl()}),o("#project-videos button[data-trigger='add-video']").click(function(){t.addVideo()}),o("#project-videos .edit-video").click(function(){return t.editVideo(o(this)),!1}),o("#project-videos .delete-video").click(function(){return t.deleteVideo(o(this)),!1})},WorksForm.prototype.deleteVideo=function(e){if(void 0==e)return!1;var t=o(e).parents("li").data("id");if(0>=t)return!1;if(!confirm(workLang.confirmDelete))return!1;o(e).cuSpinner({icon:"svg-rmcommon-spinner-02"});var i={CUTOKEN_REQUEST:o("#cu-token").val(),action:"delete-video",work:o("#work-id").val(),id:t};o.post("works.php",i,function(t){if(o(e).cuSpinner(),!cuHandler.retrieveAjax(t))return!1;var i=o("#project-videos .work-videos-container > ul");o(i).find('li[data-id="'+t.id+'"]').fadeOut(300,function(){o(this).remove()})},"json")},WorksForm.prototype.editVideo=function(e){if(void 0==e)return!1;var i=o(e).parents("li").data("id");if(0>=i)return!1;o(e).cuSpinner({icon:"svg-rmcommon-spinner-02"});var r={CUTOKEN_REQUEST:o("#cu-token").val(),action:"edit-video",work:o("#work-id").val(),id:i};o.get("works.php",r,function(i){if(o(e).cuSpinner(),!cuHandler.retrieveAjax(i))return!1;var r=o("#project-videos .video-controls");o(r).find('input[data-id="video-title"]').val(i.video.title),o(r).find('input[data-id="video-description"]').val(i.video.description),o(r).find('input[data-id="video-image"]').val(i.video.image).blur(),o(r).find('input[data-id="video-url"]').val(i.video.url),o(r).find('input[data-id="video-id"]').val(i.video.id),o(r).find('button[data-trigger="add-video"]').html(workLang.update),t.showVideoControl()},"json")},WorksForm.prototype.parseVideoData=function(){var e={url:o("#project-videos input[data-id='video-url']").val(),title:o("#project-videos input[data-id='video-title']").val(),description:o("#project-videos input[data-id='video-description']").val(),image:o("#project-videos input[data-id='video-image']").val(),work:o("#work-id").val(),id:o("#project-videos input[data-id='video-id']").val()};return e},WorksForm.prototype.resetVideoControls=function(){o("#project-videos input[data-id='video-url']").val(""),o("#project-videos input[data-id='video-title']").val(""),o("#project-videos input[data-id='video-description']").val(""),o("#project-videos input[data-id='video-image']").val(""),o("#project-videos input[data-id='video-id']").val(""),o("#project-videos button[data-trigger='add-video']").html(workLang.addVideo),this.hideVideoControls()},WorksForm.prototype.showVideoControl=function(){var e=o("#project-videos input[data-id='video-url']").val();return e.length<=8?(t.resetVideoControls(),t.hideVideoControls(),!1):0==this.validURL(e)?!1:void o("#project-videos .video-controls .hidden-controls").slideDown(250)},WorksForm.prototype.hideVideoControls=function(){o("#project-videos .video-controls .hidden-controls").is(":visible")&&o("#project-videos .video-controls .hidden-controls").slideUp(250)},WorksForm.prototype.validURL=function(o){if(void 0==o||""==o)return!1;var e=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return e.test(o)?"url":"<iframe "==o.substring(0,8)?"iframe":o.substring(0,xoUrl.length-1)==xoUrl?"local":!1},WorksForm.prototype.parseVideoPlayer=function(e,t){var i={type:t,url:"",fullScreen:!0};if("url"==t||"local"==t)return i.url=e,i.fullScreen=!0,i;var r=e.match(/<iframe.+?<\/iframe>/g);return i.url=o(r[0]).attr("src"),i.fullScreen=1,i},WorksForm.prototype.addVideo=function(){var e=this.parseVideoData(),i=this.validURL(e.url);if(0==i)return this.showNotification(workLang.noVideoUrl,"error"),!1;if(void 0==e.title||""==e.title)return this.showNotification(workLang.noVideoTitle,"error"),!1;o("#project-videos button[data-trigger='add-video']").cuSpinner({icon:"svg-rmcommon-spinner-14"});var r=this.parseVideoPlayer(e.url,i),a={CUTOKEN_REQUEST:o("#cu-token").val(),action:e.id>0?"update-video":"add-video",url:r.url,title:e.title,description:e.description,image:e.image,id:e.work,type:i,fullScreen:r.fullScreen,video:e.id};o.post("works.php",a,function(e){if(o("#project-videos button[data-trigger='add-video']").cuSpinner(),!cuHandler.retrieveAjax(e))return!1;var i=o("<a />");o(i).attr("title",e.video.title).attr("href",e.video.url).attr("target","_blank").css("background-image","url("+e.video.image+")");var r=o("<span />");cuHandler.loadIcon("svg-rmcommon-video",r),o(i).append(r);var a=o('<li data-id="'+e.video.id+'" />');o(a).css("display","none").append(i);var n=o("<div />");o(n).addClass("controls").append('<a href="#" class="edit-video">'+workLang.edit+"</a>").append('<a href="#" class="delete-video">'+workLang["delete"]+"</a>"),o(a).append(n),o("#project-videos .work-videos-container ul > li[data-id='"+e.video.id+"']").length>0&&o("#project-videos .work-videos-container ul > li[data-id='"+e.video.id+"']").remove(),o("#project-videos .work-videos-container ul").append(a),o(a).fadeIn(300),t.resetVideoControls()},"json")},WorksForm.prototype.showNotification=function(o,e){e=void 0==e||""==e?"info":e;var t="",i="";switch(e){case"error":t="svg-rmcommon-error",i="alert-danger";break;case"success":t="svg-rmcommon-ok",i="alert-success";break;case"info":default:t="svg-rmcommon-info-solid",i="alert-info"}cuHandler.notify({type:i,icon:t,text:o})},WorksForm.prototype.verifyFields=function(){if(""==o("#work-title").val())return o("#work-blocker-info span").html(workLang.notitle).addClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast"),o("#work-blocker-info button.btn-info").fadeOut("fast"),void(e=o("#work-title"));if("private"==o("#work-status").val()&&o("#visibility-groups input:checked").length<=0)return o("#work-blocker-info span").html(workLang.nogroup).addClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast"),o("#work-blocker-info button.btn-info").fadeOut("fast"),void(e=o("#work-status"));if("scheduled"==o("#work-status").val()&&""==o("#work-schedule").val())return o("#work-blocker-info span").html(workLang.notime).addClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast"),o("#work-blocker-info button.btn-info").fadeOut("fast"),void(e=o("#work-schedule"));if(o("#work-categories input:checked").length<=0)return o("#work-blocker-info span").html(workLang.nocategory).addClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast"),o("#work-blocker-info button.btn-info").fadeOut("fast"),void(e=o("#work-categories .checkbox:first-child input"));"undefined"!=typeof tinymce?tinymce.activeEditor.save():"undefined"!=typeof mdEditor&&mdEditor.save("description");var i="";o("form").each(function(){i+=""==i?o(this).serialize():"&"+o(this).serialize()}),o("#work-blocker-info span").html(workLang.saving).removeClass("work-error"),o.post("works.php",i,function(e){return e.error>0?(t.show(e.message,1),""!=e.token?o("#XOOPS_TOKEN_REQUEST").val(e.token):window.location.href=window.location.href,!1):(t.showMessage(e.message,0),o("#work-blocker-info").addClass("blocker-success"),o("#work-blocker-info button:last-child").html(workLang.done),""!=e.token&&o("#XOOPS_TOKEN_REQUEST").val(e.token),void 0!=e.data.redirect&&(window.location.href=e.data.redirect),"save"==o("#works-action").val()&&(window.location.href="works.php?action=edit&amp;id="+e.data.id),void o("#work-title-id").val(e.data.title_id))},"json")},WorksForm.prototype.showMessage=function(e,i){i>0?(o("#work-blocker-info span").html(e).addClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast"),o("#work-blocker-info button.btn-info").fadeOut("fast")):(o("#work-blocker-info span").html(e).removeClass("work-error"),o("#work-blocker-info button:last-child").fadeIn("fast").removeClass("btn-danger").addClass("btn-success"),o("#work-blocker-info button.btn-info").fadeOut("fast")),setTimeout(function(){t.closeMessage()},15e3)},WorksForm.prototype.closeMessage=function(){o("#work-blocker-info").fadeOut("fast",function(){o("#work-blocker").fadeOut("fast",function(){o("#work-blocker-info").remove(),o("#work-blocker").remove()})})},o(document).ready(function(){var o=new WorksForm;o.init()})}(jQuery);
